---
description: Homii World モノレポ全体共通基盤原則
globs:
  - "**/*.dart"
  - "**/*.ts" 
  - "**/*.js"
  - "**/*.md"
  - "**/*.yml"
  - "**/*.yaml"
alwaysApply: true
---

# Homii World 基盤原則

## 🤖 AI対話ルール（全コンポーネント共通）

### 質問・確認の原則
- **不明確な要素があれば必ず質問する** - 自己判断で進めない
- **仕様変更時は影響範囲を確認する** - 関連コンポーネントへの影響を質問
- **実装方針に複数の選択肢がある場合は提案する** - ユーザーに選択してもらう
- **既存コードとの整合性を確認する** - 既存パターンとの違いがある場合は確認
- **パフォーマンスやセキュリティに影響する変更は事前確認**

### 作業進行ルール
- **タスクを明確に整理してから実装開始** - TodoWriteツールでタスク管理
- **実装完了後は必ずlintチェック** - エラー0個を目指す
- **コンポーネント間互換性を必ず確認** - 既存機能が正常動作するか
- **設計書と実装の同期を確認** - 実装後に設計書の更新が必要か確認

### MCP活用ルール
- **Serena MCP**: LSPベースのセマンティックコード分析、リファクタリング優先使用
- **Linear MCP**: タスク・イシュー管理、プロジェクト進捗追跡に積極活用
- **Supabase MCP**: データベース管理、SQL実行、migration適用
- **GitHub MCP**: PR作成、コードレビュー、リポジトリ管理の自動化
- **Figma MCP**: デザイン仕様確認、UI実装時のデザイン連携
- **Airtable MCP**: データ構造確認、API仕様との整合性チェック
- **Firebase MCP**: Firebase設定確認、Functions・Auth管理

## 🏗️ Clean Architecture 原則

### 全コンポーネント共通
- **層分離の厳守**: UI層 → ビジネスロジック層 → データ層（一方向依存）
- **依存関係逆転**: 抽象への依存、具体実装への依存回避
- **単一責任原則**: 各クラス・関数は一つの責任のみ
- **開閉原則**: 拡張に対してオープン、修正に対してクローズド

### 設計整合性（最重要）
- **要求仕様適合**: 機能要件・非機能要件充足確認
- **方式設計準拠**: アーキテクチャパターン整合性維持
- **API仕様**: データ交換フォーマット一致確認
- **UI設計**: 画面仕様・遷移との適合性確認

## 🔒 セキュリティ基盤ルール

### 認証・認可
- **認証必須**: 保護された操作は全て有効なトークン必要
- **権限チェック**: 適切なユーザー権限確認実装
- **トークン管理**: 安全な保存・ライフサイクル管理

### データ保護
- **シークレット管理**: 環境変数・設定ファイル経由、ハードコード禁止
- **入力検証**: 全入力データの適切なバリデーション実装
- **データ暗号化**: 機密データの適切な暗号化実装

## 💡 品質基準

### コード品質
- **型安全性**: 厳格な型システム活用、`any`型使用最小化
- **null安全性**: null安全言語機能の適切な活用
- **命名規則**: 意味のある名前、一貫した命名パターン
- **コメント**: 複雑なロジックには適切な説明コメント

### エラーハンドリング
- **統一パターン**: 一貫したエラーハンドリングパターン
- **ユーザーフレンドリー**: わかりやすいエラーメッセージ
- **ログ出力**: 適切なログレベルとフォーマット
- **回復処理**: 可能な限りの自動回復機能

## 🔄 継続的改善

### 品質管理
- **定期レビュー**: コード品質・設計品質の定期確認
- **メトリクス監視**: パフォーマンス・コスト・品質メトリクス追跡
- **フィードバック反映**: ユーザーフィードバックの積極的な反映
- **技術負債管理**: 技術負債の定期的な解消

### 学習・改善
- **ベストプラクティス**: 業界標準・最新技術の積極的な取り入れ
- **知識共有**: チーム内での知識・経験の共有促進
- **プロセス改善**: 開発プロセスの継続的な見直し・改善

---

**重要**: このファイルは全コンポーネントで常に適用される基盤原則です。疑問・不明点があれば推測せず質問してください。一貫性・保守性・効率性が目標です。